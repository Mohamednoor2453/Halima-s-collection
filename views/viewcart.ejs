<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Cart</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <div>
        <nav>
            <div class="site-title">
                <a href="/"><h1>Halima Collection</h1></a>
                <p class="font-semibold">Your One Stop Shop</p>
            </div>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/products/womensproducts">Women</a></li>
                <li><a href="/products/mensproducts">Men</a></li>
                <li><a href="/products/sneakers">Sneakers</a></li>
                <li><a href="/products/accessories">Accessories</a></li>
            </ul>
        </nav>
            </div>

            

    <div class="view-cart">
         <h1>Your Shopping Cart</h1>

         <% if (cart && cart.items.length > 0) { %>
            <ul>
                <% cart.items.forEach(item => { %>
                    <li class="item-details">
                        <img src="<%= item.productId.images[0] %>" alt="<%= item.productId.name %>">
                        <h3>Product: <%= item.productId.name %></h3>
                        <p>Quantity: <%= item.quantity %></p>
                        <p>Price: Ksh <%= item.productId.price %></p>
                        <p>Total Price: Ksh <%= item.totalPrice %></p>
                    </li>
                    
                    <button onclick="removeFromCart('<%= cart.userId %>', '<%= item.productId._id %>')" class="remove-btn">Remove</button>
                    
                <% }) %>
            </ul>
            <p>Total Items: <%= cart.totalItem %></p>
            <p>Total Cart Price: Ksh <%= cart.cartTotalPrice %></p>

            <button onclick="clearCart('<%= cart.userId %>')" class="remove-btn">Clear Cart</button>

            <form action="/oderForm" method="GET">
                <input type="hidden" name="userId" value="<%= cart.userId %>">
                <button type="submit">Order Now</button>
            </form>
        <% } else { %>
            <p>Your cart is empty.</p>
        <% } %>
            </div>
    
    
   
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section about">
                <h3>About Us</h3>
                <p>Your go-to source for fashion and style. Discover our curated collection.</p>
            </div>
            <div class="footer-section links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/mensproducts">Men</a></li>
                    <li><a href="/womensproducts">Women</a></li>
                    <li><a href="/contact">Contact Us</a></li>
                </ul>
            </div>
            <div class="footer-section social">
                <h3>Follow Us</h3>
                
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2024 Halima Collection. All Rights Reserved.
        </div>
    </footer>
 

    <script>
        async function removeFromCart(userId, productId) {
    try {
        const response = await fetch('/cart/removefrom_cart', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ userId, productId })
        });

        // Try parsing the response as JSON
        const data = await response.json();

        if (response.ok) {
            alert(data.message);
            location.reload();
        } else {
            alert(data.message || 'Error removing item from cart');
        }
    } catch (error) {
        // Handle cases where the response isn't JSON or thereâ€™s a network error
        alert('An error occurred: ' + error.message);
        console.error('Error details:', error);
    }
}


async function clearCart(userId) {
    try {
        const response = await fetch('/cart/clear_cart', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ userId })
        });

        const data = await response.json();

        if (response.ok) {
            alert(data.message);
            location.reload();  // Reload the page to show an empty cart
        } else {
            alert(data.message || 'Error clearing cart');
        }
    } catch (error) {
        alert('An error occurred: ' + error.message);
        console.error('Error details:', error);
    }
}


    </script>

</body>
</html>